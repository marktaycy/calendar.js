/*!
 * calendar.js v0.0.1
 * Copyright 2012, Tim Branyen (@tbranyen)
 * calendar.js may be freely distributed under the MIT license.
 */
(function(){function h(a,e){this.el=typeof a=="string"?b.querySelector(a):a,this.options={tagName:{month:"table",week:"tr",day:"td"},className:{month:"month",week:"week",day:"day",today:"today"}},d(this.options,e),d(this,c)}var a=this,b=this.document,c={callbacks:{},on:function(a,b){var c=this.callbacks[a]=this.callbacks[a]||[];return c.push(b),this},once:function(a,b){function d(){c.off(a,d),b.apply(this,arguments)}var c=this;return b._off=d,this.on(a,d),this},off:function(a,b){var c,d=this.callbacks[a];return d?arguments.length===1?(delete this.callbacks[a],this):(c=d.indexOf(b._off||b),~c&&d.splice(c,1),this):this},emit:function(a){var b,c,d=[].slice.call(arguments,1),e=this.callbacks[a];if(e){e=e.slice(0);for(b=0,c=e.length;b<c;++b)e[b].apply(this,d)}return this},listeners:function(a){return this.callbacks[a]||[]},hasListeners:function(a){return Boolean(this.listeners(a).length)}},d=function(a){var b,c,d,f=e(arguments).slice(1);for(b=0;b<f.length;b++){d=f[b];if(typeof d=="object")for(c in d)a[c]=d[c]}return a},e=function(a){return Array.prototype.slice.call(a)},f=function(){return["January","February","March","April","May","June","July","August","September","October","November","December"][this.getMonth()]},g=function(){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][this.getDay()]};h.prototype={init:function(){return this.date=new Date,d(this.date,{getFullMonth:f,getFullWeek:g}),this.update(),this.render(),this},update:function(){var a,b,c,d,e,f=[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]],g=new Date(this.date.getTime()),h=1,i=g.getMonth();g.setDate(h);for(;;){if(g.getMonth()!==i)break;b=g.getDate(),a=g.getDay(),c=~~((b+(6-a))/7),h===1&&(d=[c,a]),f[c][a]=h,g.setDate(++h)}return f.forEach(function(a,b){var c,e=new Date(g.getTime());e.setDate(1),e.setMonth(e.getMonth()-1),b<=d[0]&&a.forEach(function(f,g){var h=b*7+g,i=d[0]*7+d[1],j=b===d[0]?d[1]:7;g<j&&(c=c?1:-(i-h),e.setDate(e.getDate()+c),a[g]={type:"prev",val:e.getDate()})},this)},this),f.forEach(function(a,b){var d,e=new Date(g.getTime());e.setDate(g.getDate()-1),b>=c&&a.forEach(function(b,c){b||(e.setDate(e.getDate()+1),a[c]={type:"next",val:e.getDate()})},this)},this),this._month=f,this.emit("change"),this},render:function(){this.emit("beforeRender");var a=this.el.cloneNode(),c=b.createElement(this.options.tagName.month);return c.className=this.options.className.month,this._month.forEach(function(a){var d=b.createElement(this.options.tagName.week);d.className=this.options.className.week,a.forEach(function(a){var c=b.createElement(this.options.tagName.day);c.className=this.options.className.day,a===this.date.getDate()?c.className+=" "+this.options.className.today:a.type==="prev"?c.className+=" prev":a.type==="next"&&(c.className+=" next"),typeof a=="object"?c.innerHTML=a.val:c.innerHTML=a||"&nbsp;",d.appendChild(c)},this),c.appendChild(d)},this),a.appendChild(c),this.el.parentNode.replaceChild(a,this.el),this.el=a,this.emit("afterRender"),this}},h.Events=c,a.Calendar=h})();