/*!
 * calendar.js v0.0.1
 * Copyright 2012, Tim Branyen (@tbranyen)
 * calendar.js may be freely distributed under the MIT license.
 */
(function(){function h(a,e){this.el=typeof a=="string"?b.querySelector(a):a,this.options={tagName:{month:"table",week:"tr",day:"td"},className:{month:"month",week:"week",day:"day"}},d(this.options,e),d(this,c),this._callbacks={}}var a=this,b=this.document,c={callbacks:{},on:function(a,b,c){var d=this.callbacks[a]=this.callbacks[a]||[];return b._context=c,d.push(b),this},once:function(a,b,c){function e(){d.off(a,e),b.apply(this,arguments)}var d=this;return b._off=e,this.on(a,e,c),this},off:function(a,b){var c,d=this.callbacks[a];return d?arguments.length===1?(delete this.callbacks[a],this):(c=d.indexOf(b._off||b),~c&&d.splice(c,1),this):this},emit:function(a){var b,c,d=[].slice.call(arguments,1),e=this.callbacks[a];if(e){e=e.slice(0);for(b=0,c=e.length;b<c;++b)e[b].apply(e[b]._context||this,d)}return this},listeners:function(a){return this.callbacks[a]||[]},hasListeners:function(a){return Boolean(this.listeners(a).length)}},d=function(a){var b,c,d,f=e(arguments).slice(1);for(b=0;b<f.length;b++){d=f[b];if(typeof d=="object")for(c in d)a[c]=d[c]}return a},e=function(a){return Array.prototype.slice.call(a)},f=function(){return["January","February","March","April","May","June","July","August","September","October","November","December"][this.getMonth()]},g=function(){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][this.getDay()]};h.prototype={init:function(){return this.date=new Date,d(this.date,{getFullMonth:f,getFullWeek:g}),this.update(),this.render(),this},update:function(){var a,b,c,d,e,f=[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]],g=new Date(this.date),h=1,i=g.getMonth();g.setDate(h);for(;;){if(g.getMonth()!==i)break;b=g.getDate(),a=g.getDay(),c=~~((b+(6-a))/7),h===1&&(d=[c,a]),f[c][a]={value:new Date(g),type:"day"},g.setDate(++h)}var j=new Date(g);j.setDate(1),j.setMonth(j.getMonth()-1),f.forEach(function(a,b){b<=d[0]&&a.forEach(function(c,f){var g=b*7+f,h=d[0]*7+d[1],i=b===d[0]?d[1]:7;f<i&&(e=e?1:-(h-g),j.setDate(j.getDate()+e),a[f]={value:new Date(j),type:"prev"})},this)},this);var k=new Date(g);return k.setDate(g.getDate()-1),f.forEach(function(a,b){b>=c&&a.forEach(function(b,c){b||(k.setDate(k.getDate()+1),a[c]={value:new Date(k),type:"next"})},this)},this),this._month=f,this.emit("update"),this},renderDay:function(a,b){typeof a=="function"&&(a="all",b=a),this._callbacks[a]=b},render:function(){this.update();var a=this.el.cloneNode(!1),c=b.createElement(this.options.tagName.month);return c.className=this.options.className.month,this.emit("beforeRender",this),this._month.forEach(function(a){var d=b.createElement(this.options.tagName.week);d.className=this.options.className.week,a.forEach(function(a){var c=b.createElement(this.options.tagName.day);c.className=this.options.className.day,a.value.getFullYear()===this.date.getFullYear()&&a.value.getMonth()===this.date.getMonth()&&a.value.getDate()===this.date.getDate()&&(a.type="today"),a.type!=="day"&&(c.className=[c.className,"day"].join(" ")),c.className=[c.className,a.type].join(" "),this._callbacks[a.type]?this._callbacks[a.type](c,a):c.innerHTML=a.value.getDate()||"&nbsp;",d.appendChild(c)},this),c.appendChild(d)},this),a.appendChild(c),this.el.parentNode.replaceChild(a,this.el),this.el=a,this.emit("afterRender",this),this}},h.Events=c,a.Calendar=h})();